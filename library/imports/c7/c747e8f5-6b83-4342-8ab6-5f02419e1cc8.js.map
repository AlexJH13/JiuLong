{"version":3,"sources":["assets/Script/Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { XY } from \"../XYUtils/XYUtils\";\nimport Cell from \"./Cell\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class Game extends cc.Component {\n\n    @property(cc.Prefab)\n    cellPrefab: cc.Prefab = null;\n\n    @property(cc.Node)\n    mainNode: cc.Node = null;\n\n    // 5*7 的二维数组\n    matrix: cc.Node[][]  = [];\n\n\n    touchSum: number = 0;\n    showSum: number = 0;\n\n    touchEnable: boolean = false;\n    lastTouchCell: Cell = null;\n\n    touchNodeList: cc.Node[] = [];\n    \n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoved.bind(this), this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touchEnded.bind(this), this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touchEnded.bind(this), this);\n    }\n\n    start () {\n        this.createGame();\n    }\n\n    private createGame(): void {\n        for (let row = 0; row < 7; row++) {\n            let rowArray = []\n            for (let clo = 0; clo < 5; clo++) {\n                let node = cc.instantiate(this.cellPrefab);\n                let cell = node.getComponent(Cell);\n                cell.id = XY.generateId();\n                cell.matrix = cc.v2(row, clo);\n                cell.value = Math.pow(2, this.getRandomIntInclusive(1, 7));\n                node.parent = this.mainNode;\n                rowArray.push(node);\n            }\n            this.matrix.push(rowArray);\n        }\n    }\n\n    private getRandomIntInclusive(min: number, max: number): number {\n        // 确保 min 和 max 是整数\n        min = Math.ceil(min);\n        max = Math.floor(max);\n        return Math.floor(Math.random() * (max - min + 1)) + min; // 包含 min 和 max\n    }\n\n    private addTouchCell(cell: Cell): void {\n        this.touchNodeList.push(cell.node);\n        cell.touched = true;\n        this.touchSum += cell.value;\n        this.showSum = Math.pow(2, Math.ceil(Math.log2(this.touchSum)));\n        if (cc.isValid(this.lastTouchCell)) {\n            cell.preTouchCell = this.lastTouchCell;\n        }\n        this.lastTouchCell = cell;\n    }\n\n    private removeTouchCell(): void {\n        let cellNode = this.touchNodeList[this.touchNodeList.length - 1];\n        let cell = cellNode.getComponent(Cell);\n        if (cc.isValid(cell.preTouchCell)) {\n            this.touchNodeList.pop();\n            cell.touched = false;\n            \n            this.lastTouchCell = cell.preTouchCell;\n            cell.preTouchCell = null;\n\n            this.touchSum  -= cell.value;\n            this.showSum = Math.pow(2, Math.ceil(Math.log2(this.touchSum)));\n            \n        }\n    }\n\n    private touchStart(event: cc.Event.EventTouch): void {\n        for (let row = 0; row < 7; row++) {\n            for (let clo = 0; clo < 5; clo++) {\n                let cell = this.matrix[row][clo];\n                if(cell.getBoundingBoxToWorld().contains(event.getLocation())) {\n                    this.touchEnable = true;\n                    this.addTouchCell(cell.getComponent(Cell));\n                    return;\n                }\n            }\n        }\n    }\n\n    private touchMoved(event: cc.Event.EventTouch): void {\n        if (this.touchEnable) {\n            if (cc.isValid(this.lastTouchCell)) {\n                for (let row = this.lastTouchCell.matrix.x - 1; row <= this.lastTouchCell.matrix.x + 1; row++) {\n                    for (let clo = this.lastTouchCell.matrix.y -1; clo <= this.lastTouchCell.matrix.y + 1; clo++) {\n                        if (row < 0 || row > 6 || clo < 0 || clo > 4) {\n                            continue;\n                        }\n                        let cellNode = this.matrix[row][clo];\n                        let cell = cellNode.getComponent(Cell);\n\n                        if(cellNode.getBoundingBoxToWorld().contains(event.getLocation())) { \n                            if (cc.isValid(this.lastTouchCell.preTouchCell)) {\n                                if (this.lastTouchCell.preTouchCell.id === cell.id) {\n                                    this.removeTouchCell();\n                                    return;\n                                }\n                            }\n\n                            if (cell.touched || cell.value > this.showSum) {\n                                continue;\n                            }\n                            \n                            this.addTouchCell(cell);\n                            return;\n                        }\n                    }\n                }\n            }\n            \n        }\n    }\n\n    private touchEnded(event: cc.Event.EventTouch): void {\n        this.touchSum = 0;\n        this.showSum = 0;\n        this.touchEnable = false;\n        this.lastTouchCell = null;\n        this.touchNodeList = [];\n    }\n\n    // update (dt) {}\n}\n"]}