{"version":3,"sources":["assets/Script/Game.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,4EAA4E;AAC5E,mBAAmB;AACnB,sFAAsF;AACtF,8BAA8B;AAC9B,sFAAsF;;;;;;;;;;;;;;;;;;;;;AAEtF,+BAA0B;AAEpB,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAkC,wBAAY;IAA9C;QAAA,qEA+FC;QA5FG,gBAAU,GAAc,IAAI,CAAC;QAG7B,cAAQ,GAAY,IAAI,CAAC;QAEzB,YAAY;QACZ,YAAM,GAAiB,EAAE,CAAC;QAG1B,cAAQ,GAAW,CAAC,CAAC;QACrB,aAAO,GAAW,CAAC,CAAC;QACpB,qBAAe,GAAW,CAAC,CAAC;QAE5B,mBAAa,GAAc,EAAE,CAAC;;QA8E9B,iBAAiB;IACrB,CAAC;IA5EG,wBAAwB;IAExB,qBAAM,GAAN;QACI,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;QAC9E,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;QAC7E,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;QAC5E,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;IACnF,CAAC;IAED,oBAAK,GAAL;QACI,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IAEO,yBAAU,GAAlB;QACI,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;YAC9B,IAAI,QAAQ,GAAG,EAAE,CAAA;YACjB,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;gBAC9B,IAAI,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC3C,IAAI,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC;gBACnC,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;gBAC9B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC3D,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC;gBAC5B,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACvB;YACD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC9B;IACL,CAAC;IAEO,oCAAqB,GAA7B,UAA8B,GAAW,EAAE,GAAW;QAClD,mBAAmB;QACnB,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACrB,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACtB,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,eAAe;IAC7E,CAAC;IAEO,yBAAU,GAAlB,UAAmB,KAA0B;QACzC,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;YAC9B,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;gBAC9B,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;gBACjC,IAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,EAAE;oBAC3D,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;oBACjB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC9B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,KAAK,CAAC;oBACrD,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,KAAK,CAAC;oBAC/C,OAAO;iBACV;aACJ;SACJ;IACL,CAAC;IAEO,yBAAU,GAAlB,UAAmB,KAA0B;QACzC,IAAI,IAAI,CAAC,eAAe,IAAI,CAAC,EAAE;YAC3B,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;gBAC9B,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;oBAC9B,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;oBACjC,IAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE;wBACvJ,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;wBACjB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAC9B,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,KAAK,CAAC;wBAC/C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;wBAC/D,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;wBACpC,OAAO;qBACV;iBACJ;aACJ;SACJ;IACL,CAAC;IAEO,yBAAU,GAAlB,UAAmB,KAA0B;QACzC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QAClB,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;IAC5B,CAAC;IAzFD;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;4CACS;IAG7B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;0CACO;IANR,IAAI;QADxB,OAAO;OACa,IAAI,CA+FxB;IAAD,WAAC;CA/FD,AA+FC,CA/FiC,EAAE,CAAC,SAAS,GA+F7C;kBA/FoB,IAAI","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport Cell from \"./Cell\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class Game extends cc.Component {\n\n    @property(cc.Prefab)\n    cellPrefab: cc.Prefab = null;\n\n    @property(cc.Node)\n    mainNode: cc.Node = null;\n\n    // 5*7 的二维数组\n    matrix: cc.Node[][]  = [];\n\n\n    touchSum: number = 0;\n    showSum: number = 0;\n    touchStartValue: number = 0;\n\n    touchNodeList: cc.Node[] = [];\n    \n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoved.bind(this), this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touchEnded.bind(this), this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touchEnded.bind(this), this);\n    }\n\n    start () {\n        this.createGame();\n    }\n\n    private createGame(): void {\n        for (let row = 0; row < 7; row++) {\n            let rowArray = []\n            for (let clo = 0; clo < 5; clo++) {\n                let node = cc.instantiate(this.cellPrefab);\n                let cell = node.getComponent(Cell);\n                cell.matrix = cc.v2(row, clo);\n                cell.value = Math.pow(2, this.getRandomIntInclusive(1, 7));\n                node.parent = this.mainNode;\n                rowArray.push(node);\n            }\n            this.matrix.push(rowArray);\n        }\n    }\n\n    private getRandomIntInclusive(min: number, max: number): number {\n        // 确保 min 和 max 是整数\n        min = Math.ceil(min);\n        max = Math.floor(max);\n        return Math.floor(Math.random() * (max - min + 1)) + min; // 包含 min 和 max\n    }\n\n    private touchStart(event: cc.Event.EventTouch): void {\n        for (let row = 0; row < 7; row++) {\n            for (let clo = 0; clo < 5; clo++) {\n                let cell = this.matrix[row][clo];\n                if(cell.getBoundingBoxToWorld().contains(event.getLocation())) {\n                    cell.scale = 1.1;\n                    this.touchNodeList.push(cell);\n                    this.touchStartValue = cell.getComponent(Cell).value;\n                    this.touchSum += cell.getComponent(Cell).value;\n                    return;\n                }\n            }\n        }\n    }\n\n    private touchMoved(event: cc.Event.EventTouch): void {\n        if (this.touchStartValue != 0) {\n            for (let row = 0; row < 7; row++) {\n                for (let clo = 0; clo < 5; clo++) {\n                    let cell = this.matrix[row][clo];\n                    if(cell.getBoundingBoxToWorld().contains(event.getLocation()) && this.touchNodeList.indexOf(cell) === -1 && cell.getComponent(Cell).value <= this.showSum) { \n                        cell.scale = 1.1;\n                        this.touchNodeList.push(cell);\n                        this.touchSum += cell.getComponent(Cell).value;\n                        this.showSum = Math.pow(2, Math.ceil(Math.log2(this.touchSum)))\n                        cc.log(this.touchSum, this.showSum);\n                        return;\n                    }\n                }\n            }\n        }\n    }\n\n    private touchEnded(event: cc.Event.EventTouch): void {\n        this.touchSum = 0;\n        this.showSum = 0;\n        this.touchStartValue = 0;\n        this.touchNodeList = [];\n    }\n\n    // update (dt) {}\n}\n"]}